# UE5シナリオ自動変換AIソフトウェア - ユーザーマニュアル

## 目次

1. [はじめに](#1-はじめに)
2. [インストールと起動](#2-インストールと起動)
3. [シナリオの書き方](#3-シナリオの書き方)
4. [ソフトウェアの使用方法](#4-ソフトウェアの使用方法)
5. [生成ファイルの説明](#5-生成ファイルの説明)
6. [UE5での利用方法](#6-ue5での利用方法)
7. [トラブルシューティング](#7-トラブルシューティング)
8. [よくある質問](#8-よくある質問)

## 1. はじめに

UE5シナリオ自動変換AIソフトウェアは、テキスト形式で書かれたゲームシナリオを、フローチャート（draw.io形式）とUE5用データテーブル（CSV形式）に自動変換するツールです。このマニュアルでは、ソフトウェアの使用方法と各機能について詳しく説明します。

## 2. インストールと起動

### 2.1 必要環境

- Python 3.8以上
- 必要なPythonパッケージ:
  - streamlit
  - spacy
  - openai
  - xml.etree.ElementTree (標準ライブラリ)
  - csv (標準ライブラリ)

### 2.2 インストール手順

1. リポジトリをクローン:
   ```bash
   git clone https://github.com/yourusername/ue5-scenario-converter.git
   cd ue5-scenario-converter
   ```

2. 必要なパッケージをインストール:
   ```bash
   pip install -r requirements.txt
   ```

3. spaCyの日本語モデルをインストール:
   ```bash
   python -m spacy download ja_core_news_sm
   ```

### 2.3 アプリケーションの起動

```bash
streamlit run scenario_converter_app.py
```

起動後、Webブラウザで `http://localhost:8501` にアクセスすると、アプリケーションのインターフェースが表示されます。

## 3. シナリオの書き方

シナリオは以下の形式で記述してください。

### 3.1 基本構造

```
【シーン名】
キャラクター名：セリフ内容
キャラクター名：セリフ内容

1. 選択肢1 → 次のシーン名
2. 選択肢2 → 次のシーン名
```

### 3.2 記述ルール

- シーン名は【】（全角括弧）で囲みます
- キャラクター名とセリフは「：」（全角コロン）で区切ります
- 選択肢は「数字. 選択肢テキスト → 次のシーン名」の形式で記述します
- 選択肢がない場合は省略可能です

### 3.3 サンプルシナリオ

```
【プロローグ】
主人公：こんにちは、私は冒険者です。
ナレーター：あなたは古い城の前に立っています。

1. 城に入る → 城内部
2. 引き返す → 村

【城内部】
主人公：暗くて怖いですね。
魔法使い：ようこそ、勇敢な冒険者よ。

1. 魔法使いと話す → 会話
2. 逃げる → プロローグ

【会話】
魔法使い：何か手伝えることはありますか？
主人公：この城について教えてください。
魔法使い：この城は古い秘密を隠しています。
```

## 4. ソフトウェアの使用方法

### 4.1 シナリオ変換モード

1. サイドバーから「シナリオ変換」を選択
2. 「シナリオファイルをアップロード」ボタンをクリックし、テキストファイル（.txtまたは.md）を選択
3. 変換オプション（フローチャート生成、データテーブル生成）を選択
4. 「変換実行」ボタンをクリック
5. 変換結果が表示され、生成されたファイルをダウンロード可能

### 4.2 サンプル実行モード

1. サイドバーから「サンプル実行」を選択
2. サンプルシナリオが表示されます
3. 「サンプルを変換」ボタンをクリック
4. 変換結果が表示され、生成されたファイルをダウンロード可能

### 4.3 使用方法モード

サイドバーから「使用方法」を選択すると、ソフトウェアの使用方法や書式のガイドラインが表示されます。

## 5. 生成ファイルの説明

### 5.1 フローチャートファイル (.drawio)

- draw.io形式のフローチャート
- シーンをノードとして表示
- 選択肢による分岐を矢印で表現
- draw.ioアプリケーションまたはWebサイト（https://app.diagrams.net/）で開いて編集可能

### 5.2 データテーブルファイル (.csv)

#### 5.2.1 DialogueTable.csv

セリフデータを格納するテーブル

| フィールド | 説明 |
|------------|------|
| ID | セリフの一意識別子 |
| SceneID | セリフが属するシーンのID |
| SceneName | シーン名 |
| CharacterName | 発言キャラクター名 |
| DialogueText | セリフ内容 |
| EmotionTag | 感情タグ（デフォルトは"Normal"） |
| NextDialogueID | 次のセリフのID |
| HasChoices | 選択肢の有無 |
| ChoiceCount | 選択肢の数 |

#### 5.2.2 ChoiceTable.csv

選択肢データを格納するテーブル

| フィールド | 説明 |
|------------|------|
| ID | 選択肢の一意識別子 |
| DialogueID | 選択肢が属するセリフのID |
| ChoiceText | 選択肢のテキスト |
| TargetSceneID | 遷移先シーンのID |
| TargetSceneName | 遷移先シーン名 |
| ChoiceIndex | 選択肢の表示順序 |

#### 5.2.3 SceneTable.csv

シーンデータを格納するテーブル

| フィールド | 説明 |
|------------|------|
| ID | シーンの一意識別子 |
| SceneName | シーン名 |
| Description | シーンの説明 |
| FirstDialogueID | シーン内最初のセリフのID |
| DialogueCount | シーン内のセリフ数 |
| HasChoices | 選択肢の有無 |
| IsEndScene | 終了シーンかどうか |

#### 5.2.4 CharacterTable.csv

キャラクターデータを格納するテーブル

| フィールド | 説明 |
|------------|------|
| ID | キャラクターの一意識別子 |
| CharacterName | キャラクター名 |
| Description | キャラクターの説明 |
| DialogueCount | キャラクターのセリフ数 |

### 5.3 構造体定義ファイル (ScenarioDataStructs.h)

UE5で使用するためのC++構造体定義ファイル。各データテーブルに対応する構造体が定義されています。

## 6. UE5での利用方法

### 6.1 構造体定義の追加

1. 生成された`ScenarioDataStructs.h`ファイルをUE5プロジェクトの適切なディレクトリ（例：`Source/YourGame/Public/`）にコピー
2. プロジェクトをビルド

### 6.2 データテーブルの作成

1. UE5エディタを開く
2. コンテンツブラウザで右クリック→「Miscellaneous」→「Data Table」を選択
3. 作成したい構造体（例：`FDialogueTableRow`）を選択
4. 作成したデータテーブルを右クリック→「Reimport」を選択
5. 対応するCSVファイル（例：`DialogueTable.csv`）を選択

### 6.3 ブループリントでの使用例

1. データテーブルをブループリントで参照
2. 「Get Data Table Row」ノードを使用して、特定のIDのデータを取得
3. 取得したデータを使用してゲームロジックを実装

### 6.4 C++での使用例

```cpp
#include "ScenarioDataStructs.h"
#include "Engine/DataTable.h"

// データテーブルの参照を取得
UDataTable* DialogueTable = LoadObject<UDataTable>(nullptr, TEXT("/Game/Data/DialogueTable"));

// 特定のIDのデータを取得
FDialogueTableRow* DialogueRow = DialogueTable->FindRow<FDialogueTableRow>(FName("DLG_0001"), TEXT(""));

if (DialogueRow)
{
    // データを使用
    FString CharacterName = DialogueRow->CharacterName;
    FString DialogueText = DialogueRow->DialogueText;
    
    // ゲームロジックを実装
    // ...
}
```

## 7. トラブルシューティング

### 7.1 シナリオ解析エラー

**問題**: シナリオの解析に失敗する

**解決策**:
- シナリオの書式が正しいか確認（【】や：の使用など）
- 特殊文字や制御文字が含まれていないか確認
- ファイルのエンコーディングがUTF-8であることを確認

### 7.2 フローチャート表示エラー

**問題**: 生成されたフローチャートがdraw.ioで正しく表示されない

**解決策**:
- draw.ioの最新バージョンを使用しているか確認
- XMLファイルが破損していないか確認
- 複雑すぎるシナリオの場合、シンプルな部分から試す

### 7.3 データテーブルインポートエラー

**問題**: UE5でCSVファイルのインポートに失敗する

**解決策**:
- CSVファイルのフォーマットが正しいか確認
- 構造体定義とCSVのヘッダーが一致しているか確認
- UE5のバージョンが5.4以降であることを確認

## 8. よくある質問

### Q1: サポートされているシナリオの最大サイズはどれくらいですか？

A1: 理論上の制限はありませんが、非常に大規模なシナリオ（100シーン以上）の場合、処理に時間がかかる場合があります。大規模なシナリオは、複数の小さなファイルに分割することをお勧めします。

### Q2: 日本語以外の言語もサポートしていますか？

A2: 基本的な機能は多言語に対応していますが、最適なパフォーマンスを得るには日本語の使用をお勧めします。英語のサポートも比較的安定しています。

### Q3: 生成されたフローチャートのレイアウトをカスタマイズできますか？

A3: 生成されたdraw.ioファイルをdraw.ioアプリケーションで開き、自由にレイアウトを調整できます。自動生成されたレイアウトは基本的なものであり、手動での調整が必要な場合があります。

### Q4: UE5のどのバージョンに対応していますか？

A4: UE5.4以降のバージョンに対応しています。それ以前のバージョンでも基本的な機能は使用できますが、一部の機能に制限がある場合があります。

### Q5: オープンソースですか？コードを修正できますか？

A5: はい、このソフトウェアはオープンソースです。GitHubリポジトリからコードを取得し、自由に修正・拡張できます。プルリクエストも歓迎します。

